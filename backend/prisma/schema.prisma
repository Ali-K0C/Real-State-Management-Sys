generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String               @id @default(uuid())
  email           String               @unique
  password        String
  firstName       String
  lastName        String
  contactNo       String
  createdAt       DateTime             @default(now())
  role            UserRole             @default(USER)
  maintenanceReqs MaintenanceRequest[]
  properties      Property[]
  landlordLeases  RentalLease[]        @relation("LandlordLeases")
  tenantLeases    RentalLease[]        @relation("TenantLeases")

  @@index([role])
}

model Property {
  id              String               @id @default(uuid())
  userId          String
  title           String
  description     String
  price           Decimal              @db.Decimal(12, 2)
  location        String
  address         String
  propertyType    String
  bedrooms        Int
  bathrooms       Int
  areaSqft        Int
  status          String               @default("Available")
  listingType     ListingType          @default(FOR_SALE)
  monthlyRent     Decimal?             @db.Decimal(12, 2)
  securityDeposit Decimal?             @db.Decimal(12, 2)
  availableFrom   DateTime?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  isForRent       Boolean              @default(false)
  maintenanceReqs MaintenanceRequest[]
  user            User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  rentalListing   RentalListing?

  @@index([userId])
  @@index([location])
  @@index([status])
  @@index([isForRent])
  @@index([listingType])
}

model RentalListing {
  id              String        @id @default(uuid())
  propertyId      String        @unique
  monthlyRent     Decimal       @db.Decimal(10, 2)
  securityDeposit Decimal       @db.Decimal(10, 2)
  availableFrom   DateTime
  leaseDuration   Int
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  leases          RentalLease[]
  property        Property      @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([isActive])
  @@index([availableFrom])
}

model RentalLease {
  id              String            @id @default(uuid())
  rentalListingId String
  landlordId      String
  tenantId        String
  startDate       DateTime
  endDate         DateTime
  monthlyRent     Decimal           @db.Decimal(10, 2)
  securityDeposit Decimal           @db.Decimal(10, 2)
  paymentDay      Int
  status          RentalLeaseStatus @default(PENDING)
  notes           String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  payments        RentPayment[]
  landlord        User              @relation("LandlordLeases", fields: [landlordId], references: [id], onDelete: Cascade)
  rentalListing   RentalListing     @relation(fields: [rentalListingId], references: [id], onDelete: Cascade)
  tenant          User              @relation("TenantLeases", fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([landlordId])
  @@index([tenantId])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
}

model RentPayment {
  id            String            @id @default(uuid())
  leaseId       String
  amount        Decimal           @db.Decimal(10, 2)
  dueDate       DateTime
  paidDate      DateTime?
  status        RentPaymentStatus @default(DUE)
  paymentMethod PaymentMethod?
  notes         String?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  lease         RentalLease       @relation(fields: [leaseId], references: [id], onDelete: Cascade)

  @@index([leaseId])
  @@index([status])
  @@index([dueDate])
}

model MaintenanceRequest {
  id          String            @id @default(uuid())
  propertyId  String
  requestedBy String
  title       String
  description String
  status      MaintenanceStatus @default(PENDING)
  priority    String            @default("MEDIUM")
  notes       String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  property    Property          @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  user        User              @relation(fields: [requestedBy], references: [id], onDelete: Cascade)

  @@index([propertyId])
  @@index([requestedBy])
  @@index([status])
}

enum UserRole {
  USER
  LANDLORD
  ADMIN
}

enum RentalLeaseStatus {
  PENDING
  ACTIVE
  COMPLETED
  TERMINATED
  CANCELED
}

enum RentPaymentStatus {
  DUE
  PAID
  OVERDUE
  WAIVED
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  CREDIT_CARD
  DEBIT_CARD
  CHECK
  OTHER
}

enum MaintenanceStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELED
}

enum ListingType {
  FOR_SALE
  FOR_RENT
}
